/*! Portal A 2018 - v3.0.0
 * https://portal-a.com
 * Copyright (c) 2018; * Licensed GPLv2+ */
Math.easeInOutQuad=function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:(t--,-n/2*(t*(t-2)-1)+e)},window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var n=0;n<this.length;n++)t.call(e,this[n],n,this)}),function(t){var e={};e.requestFrame=function(e){(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)})(e)},e.scrollTo=function(n,i,o){function r(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function s(){u+=l,r(Math.easeInOutQuad(u,a,c,i)),u<i?e.requestFrame(s):o&&"function"==typeof o&&o()}var a=function(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}(),c=n-a,u=0,l=20;requestFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},i=void 0===i?500:i,s()},e.siblings=function(t,e){return Array.prototype.filter.call(t.parentNode.children,function(n){return n!==t&&(e?"."===e[0]?n.classList.contains(e.substr(1)):"#"===e[0]?n.getAttribute("id")===e.substr(1):n:n)})},e.onDocumentReady=function(t){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)},e.fadeIn=function(t,n,i){t.style.opacity=0,n=n||400;var o=(new Date).getTime(),r=function(){t.style.opacity=+t.style.opacity+(new Date-o)/n,o=(new Date).getTime(),+t.style.opacity<1?e.requestFrame(r):i&&i()};r()},e.fadeOut=function(t,n,i){t.style.opacity=0,n=n||400;var o=(new Date).getTime(),r=function(){t.style.opacity=+t.style.opacity-(new Date-o)/n,o=(new Date).getTime(),+t.style.opacity>0?e.requestFrame(r):i&&i()};r()},t.UTIL=e}(this),function(t){var e=function(){this.scrollCallbacks=[],this.init()};e.prototype.init=function(){var e=this;this.hasViewQuery()&&this.handleViewQuery(),t.history&&document.querySelector("[data-load-content]")&&(t.onpopstate=function(t){if(t.state){var n=t.state.type+"-"+t.state.id;e.handleViewQuery("?active_view="+n)}else UTIL.scrollTo(0)})},e.prototype.onScroll=function(t){"function"==typeof t&&this.scrollCallbacks.push(t)},e.prototype.hasViewQuery=function(){return location.search.indexOf("active_view")>-1},e.prototype.parseQuery=function(t){var e=t.substr(1).split("&"),n={};return e.forEach(function(t){var e=t.split("=")[0],i=t.split("=")[1];n[e]=i}),n},e.prototype.handleViewQuery=function(t){if(t=t||location.search,t=this.parseQuery(t),t.active_view){var e=document.getElementById(t.active_view);if(e){var n=document.querySelector('.js-view-toggle[href="#'+e.getAttribute("id")+'"]');this.activateViewToggle(n),this.activateView(e,n)}}},e.prototype.activateView=function(e,n){function i(t){function n(e){0===r?e(t):setTimeout(function(){n(e)},100)}var i=Mustache.render(a,t);e.innerHTML=i,n(o)}function o(i){if(n.classList.remove("is-loading"),t.history&&history.pushState(i,"",i.link),c.forEach(function(t){t.style.display="none"}),e.style.display="block",e.style.opacity="0",setTimeout(function(){e.classList.remove("animate-out"),e.classList.add("animate-in")},10),s=e.offsetTop,l){var o=document.querySelector(l);s=o?o.offsetTop:s}UTIL.scrollTo(s)}var r,s,a=e.querySelector('script[type="html/mustache-template"]'),c=UTIL.siblings(e,".js-view-target"),u=parseInt(e.getAttribute("data-load-content")),l=e.getAttribute("data-view-top");c.forEach(function(t){t.classList.remove("animate-in"),t.classList.add("animate-out")}),a?(n.classList.add("is-loading"),r=setTimeout(function(){r=0},600),a=a.innerText,fetch(PA.api+"pages/"+u).then(function(t){return t.json()}).then(function(t){targetLoaded=!0,e.setAttribute("data-url",t.link),i(t)}).catch(function(t){console.log(t)})):setTimeout(function(){o({link:e.getAttribute("data-url")})},600)},e.prototype.activateViewToggle=function(t,e){e=e||"is-active",t&&(t.classList.add(e),UTIL.siblings(t,".js-view-toggle").forEach(function(t){t.classList.remove(e)}))},t.APP=new e}(this),/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
function(t,e){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t.Mustache={},e(t.Mustache))}(this,function(t){function e(t){return"function"==typeof t}function n(t){return m(t)?"array":typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}function r(t,e){return g.call(t,e)}function s(t){return!r(y,t)}function a(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return v[t]})}function c(e,n){function o(t){if("string"==typeof t&&(t=t.split(w,2)),!m(t)||2!==t.length)throw new Error("Invalid tags: "+t);r=new RegExp(i(t[0])+"\\s*"),a=new RegExp("\\s*"+i(t[1])),c=new RegExp("\\s*"+i("}"+t[1]))}if(!e)return[];var r,a,c,p=[],f=[],d=[],g=!1,y=!1;o(n||t.tags);for(var v,E,A,k,q,S,I=new h(e);!I.eos();){if(v=I.pos,A=I.scanUntil(r))for(var U=0,V=A.length;U<V;++U)k=A.charAt(U),s(k)?d.push(f.length):y=!0,f.push(["text",k,v,v+1]),v+=1,"\n"===k&&function(){if(g&&!y)for(;d.length;)delete f[d.pop()];else d=[];g=!1,y=!1}();if(!I.scan(r))break;if(g=!0,E=I.scan(L)||"name",I.scan(b),"="===E?(A=I.scanUntil(T),I.scan(T),I.scanUntil(a)):"{"===E?(A=I.scanUntil(c),I.scan(x),I.scanUntil(a),E="&"):A=I.scanUntil(a),!I.scan(a))throw new Error("Unclosed tag at "+I.pos);if(q=[E,A,v,I.pos],f.push(q),"#"===E||"^"===E)p.push(q);else if("/"===E){if(!(S=p.pop()))throw new Error('Unopened section "'+A+'" at '+v);if(S[1]!==A)throw new Error('Unclosed section "'+S[1]+'" at '+v)}else"name"===E||"{"===E||"&"===E?y=!0:"="===E&&o(A)}if(S=p.pop())throw new Error('Unclosed section "'+S[1]+'" at '+I.pos);return l(u(f))}function u(t){for(var e,n,i=[],o=0,r=t.length;o<r;++o)(e=t[o])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}function l(t){for(var e,n,i=[],o=i,r=[],s=0,a=t.length;s<a;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),r.push(e),o=e[4]=[];break;case"/":n=r.pop(),n[5]=e[2],o=r.length>0?r[r.length-1][4]:i;break;default:o.push(e)}return i}function h(t){this.string=t,this.tail=t,this.pos=0}function p(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function f(){this.cache={}}var d=Object.prototype.toString,m=Array.isArray||function(t){return"[object Array]"===d.call(t)},g=RegExp.prototype.test,y=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},b=/\s*/,w=/\s+/,T=/\s*=/,x=/\s*\}/,L=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},h.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},p.prototype.push=function(t){return new p(t,this)},p.prototype.lookup=function(t){var n,i=this.cache;if(i.hasOwnProperty(t))n=i[t];else{for(var r,s,a=this,c=!1;a;){if(t.indexOf(".")>0)for(n=a.view,r=t.split("."),s=0;null!=n&&s<r.length;)s===r.length-1&&(c=o(n,r[s])),n=n[r[s++]];else n=a.view[t],c=o(a.view,t);if(c)break;a=a.parent}i[t]=n}return e(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(e,n){var i=this.cache,o=i[e];return null==o&&(o=i[e+":"+(n||t.tags).join(":")]=c(e,n)),o},f.prototype.render=function(t,e,n){var i=this.parse(t),o=e instanceof p?e:new p(e);return this.renderTokens(i,o,n,t)},f.prototype.renderTokens=function(t,e,n,i){for(var o,r,s,a="",c=0,u=t.length;c<u;++c)s=void 0,o=t[c],r=o[0],"#"===r?s=this.renderSection(o,e,n,i):"^"===r?s=this.renderInverted(o,e,n,i):">"===r?s=this.renderPartial(o,e,n,i):"&"===r?s=this.unescapedValue(o,e):"name"===r?s=this.escapedValue(o,e):"text"===r&&(s=this.rawValue(o)),void 0!==s&&(a+=s);return a},f.prototype.renderSection=function(t,n,i,o){function r(t){return s.render(t,n,i)}var s=this,a="",c=n.lookup(t[1]);if(c){if(m(c))for(var u=0,l=c.length;u<l;++u)a+=this.renderTokens(t[4],n.push(c[u]),i,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(t[4],n.push(c),i,o);else if(e(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");c=c.call(n.view,o.slice(t[3],t[5]),r),null!=c&&(a+=c)}else a+=this.renderTokens(t[4],n,i,o);return a}},f.prototype.renderInverted=function(t,e,n,i){var o=e.lookup(t[1]);if(!o||m(o)&&0===o.length)return this.renderTokens(t[4],e,n,i)},f.prototype.renderPartial=function(t,n,i){if(i){var o=e(i)?i(t[1]):i[t[1]];return null!=o?this.renderTokens(this.parse(o),n,i,o):void 0}},f.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},f.prototype.escapedValue=function(e,n){var i=n.lookup(e[1]);if(null!=i)return t.escape(i)},f.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.0",t.tags=["{{","}}"];var E=new f;return t.clearCache=function(){return E.clearCache()},t.parse=function(t,e){return E.parse(t,e)},t.render=function(t,e,i){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+n(t)+'" was given as the first argument for mustache#render(template, view, partials)');return E.render(t,e,i)},t.to_html=function(n,i,o,r){var s=t.render(n,i,o);if(!e(r))return s;r(s)},t.escape=a,t.Scanner=h,t.Context=p,t.Writer=f,t}),function(t){var e=function(t){if(this.el=t,this.templateSelector=t.getAttribute("data-template"),this.template=document.querySelector(this.templateSelector),this.template){this.template=this.template.innerText,this.templateData=JSON.parse(t.getAttribute("data-template-data")),this.lightbox=null,this.closeBtn=null;var e=this;this.closeHandler=function(t){e.closeBtn===t.target&&e.destroyLightbox()},this.init()}};e.prototype.init=function(){var t=this;this.el.addEventListener("click",function(e){e.preventDefault();var n=document.getElementById("background-video");n&&n.pause(),t.createLightbox(t.buildContent())})},e.prototype.buildContent=function(){return Mustache.render(this.template,this.templateData)},e.prototype.createLightbox=function(t){var e=this;t=t||"",document.body.classList.add("is-lightboxed"),this.lightbox=document.createElement("div"),this.lightbox.classList.add("pa-c-lightbox"),this.lightbox.style.opacity=0,this.lightbox.innerHTML='<div class="pa-c-lightbox__inner"><button class="pa-b-close"></button>'+t+"</div>",document.body.appendChild(this.lightbox),UTIL.fadeIn(this.lightbox,400,function(){e.lightbox.classList.add("is-visible")}),this.closeBtn=this.lightbox.querySelector(".pa-b-close"),this.closeBtn.addEventListener("click",this.closeHandler)},e.prototype.destroyLightbox=function(){var t=this;t.lightbox.classList.remove("is-visible"),setTimeout(function(){UTIL.fadeOut(t.lightbox,400,function(){document.body.classList.remove("is-lightboxed"),document.body.removeChild(t.lightbox);var e=document.getElementById("background-video");e&&e.play()})},400),this.closeBtn.removeEventListener("click",this.closeHandler)},UTIL.onDocumentReady(function(){document.querySelectorAll(".js-lightbox-toggle").forEach(function(t){new e(t)})})}(),function(t){document.querySelectorAll(".js-smooth-scroll").forEach(function(t){t.addEventListener("click",function(e){e.preventDefault();var n=t.getAttribute("href")||t.getAttribute("data-target");n&&UTIL.scrollTo(document.querySelector(n).offsetTop)})})}(),function(t){var e=function(t){this.el=t,this.activeClass=t.getAttribute("data-active-class")||"is-active",this.target=t.getAttribute("href")||t.getAttribute("data-target"),this.targetEl=document.querySelector(this.target),this.targetEl&&this.init()};e.prototype.init=function(){this.initEvents()},e.prototype.initEvents=function(){var t=this;this.el.addEventListener("click",function(e){e.preventDefault(),APP.activateViewToggle(t.el,t.activeClass),APP.activateView(t.targetEl,t.el)})},document.querySelectorAll(".js-view-toggle").forEach(function(t){new e(t)})}();